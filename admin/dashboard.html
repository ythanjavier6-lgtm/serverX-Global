 <!doctype html>
<html lang="es">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Dashboard — ServerX Admin</title>
		<meta name="description" content="Panel de control de administración." />
		<link rel="stylesheet" href="/frontend/css/site.css">
		<style>
			.admin-layout { display: flex; gap: 20px; }
			.sidebar { width: 250px; background: var(--card); border-radius: 8px; padding: 20px; position: sticky; top: 20px; height: fit-content; }
			.sidebar a { display: block; padding: 12px; margin-bottom: 8px; border-radius: 6px; color: var(--text); text-decoration: none; transition: background 0.3s; }
			.sidebar a:hover, .sidebar a.active { background: var(--accent); color: white; }
			.main-content { flex: 1; }
			.stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
			.stat-card { background: var(--card); padding: 20px; border-radius: 8px; border-left: 4px solid var(--accent); }
			.stat-card h3 { margin: 0 0 10px 0; color: var(--muted); font-size: 0.9rem; }
			.stat-card .value { font-size: 2rem; font-weight: bold; color: var(--accent); }
		</style>
	</head>
	<body>
		<div class="container">
			<header>
				<div class="brand" aria-label="ServerX">
					<svg width="34" height="34" viewBox="0 0 24 24" fill="none" aria-hidden="true"><rect width="24" height="24" rx="6" fill="#0b5fff"/></svg>
					<span>ServerX Admin</span>
				</div>
				<nav class="nav" aria-label="Navegación">
					<a href="/index.html">Sitio</a>
					<button id="logout-btn" style="background: none; border: none; color: var(--muted); cursor: pointer;">Cerrar sesión</button>
				</nav>
			</header>

			<main style="padding-top: 20px;">
				<div class="admin-layout">
					<aside class="sidebar">
						<h3 style="margin-top: 0;">Menú</h3>
						<a href="/admin/dashboard.html" class="active">Dashboard</a>
						<a href="/admin/perfil.html">Mi Perfil</a>
						<a href="/admin/usuarios.html">Usuarios</a>
						<a href="/admin/productos.html">Productos</a>
						<a href="/admin/ordenes.html">Órdenes</a>
						<a href="/admin/pagos.html">Pagos</a>
						<a href="/admin/tickets.html">Tickets</a>
						<a href="/admin/mensajes.html">Mensajes</a>
						<a href="/admin/reportes.html">Reportes</a>
						<a href="/admin/analitica.html">Analítica</a>
						<a href="/admin/logs.html">Logs</a>
						<a href="/admin/roles.html">Roles</a>
						<a href="/admin/seguridad.html">Seguridad</a>
						<a href="/admin/configuracion.html">Configuración</a>
						<a href="/admin/sistema.html">Sistema</a>
						<a href="/admin/soporte.html">Soporte</a>
						<a href="/admin/newsletter.html">Newsletter</a>
					</aside>

					<section class="main-content">
						<h1>Dashboard</h1>
						<p>Bienvenido al panel de administración de ServerX.</p>

						<div class="stat-grid">
							<div class="stat-card">
								<h3>Usuarios Activos</h3>
								<div class="value" id="active-users">0</div>
							</div>
							<div class="stat-card">
								<h3>Órdenes Pendientes</h3>
								<div class="value" id="pending-orders">0</div>
							</div>
							<div class="stat-card">
								<h3>Ingresos Totales</h3>
								<div class="value" id="total-revenue">$0</div>
							</div>
							<div class="stat-card">
								<h3>Tickets Abiertos</h3>
								<div class="value" id="open-tickets">0</div>
							</div>
						</div>

						<div class="card">
							<h2>Órdenes Recientes</h2>
							<table style="width: 100%; border-collapse: collapse;">
								<thead>
									<tr style="border-bottom: 1px solid var(--muted);">
										<th style="text-align: left; padding: 10px;">ID</th>
										<th style="text-align: left; padding: 10px;">Usuario</th>
										<th style="text-align: left; padding: 10px;">Total</th>
										<th style="text-align: left; padding: 10px;">Estado</th>
										<th style="text-align: left; padding: 10px;">Fecha</th>
									</tr>
								</thead>
								<tbody id="recent-orders">
									<tr><td colspan="5" style="text-align: center; padding: 20px; color: var(--muted);">Cargando órdenes...</td></tr>
								</tbody>
							</table>
						</div>
					</section>
				</div>
			</main>

			<footer style="margin-top: 40px;">
				<div style="display: flex; justify-content: space-between; gap: 18px; align-items: center; flex-wrap: wrap;">
					<div>
						<strong>ServerX Admin</strong>
						<div style="color: var(--muted); font-size: 0.95rem;">© 2025 ServerX. Todos los derechos reservados.</div>
					</div>
				</div>
			</footer>
		</div>

		<script src="/supabase/config/client-config.js"></script>
		<script type="module" src="/frontend/js/supabase-client.js"></script>
		<script type="module">
			import { getSupabase } from '/frontend/js/supabase-client.js';

			const supabase = await getSupabase();
			if (!supabase) { window.location.href = '/login.html'; }

			document.getElementById('logout-btn')?.addEventListener('click', async () => {
				await supabase.auth.signOut();
				window.location.href = '/index.html';
			});

			async function loadDashboard() {
				try {
					const [users, orders, tickets] = await Promise.all([
						supabase.from('users').select('id', { count: 'exact' }),
						supabase.from('orders').select('id', { count: 'exact' }).eq('status', 'pending'),
						supabase.from('tickets').select('id', { count: 'exact' }).eq('status', 'open')
					]);

					document.getElementById('active-users').textContent = users.count || 0;
					document.getElementById('pending-orders').textContent = orders.count || 0;
					document.getElementById('open-tickets').textContent = tickets.count || 0;

					const { data: recentOrders } = await supabase
						.from('orders')
						.select('id, total, status, created_at, users(email)')
						.order('created_at', { ascending: false })
						.limit(5);

					const tbody = document.getElementById('recent-orders');
					tbody.innerHTML = recentOrders?.map(order => `<tr style="border-bottom: 1px solid var(--muted);"><td style="padding: 10px;">${order.id.substring(0, 8)}</td><td style="padding: 10px;">${order.users?.email}</td><td style="padding: 10px;">$${order.total}</td><td style="padding: 10px;"><span style="background: var(--accent); color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.85rem;">${order.status}</span></td><td style="padding: 10px;">${new Date(order.created_at).toLocaleDateString('es-ES')}</td></tr>`).join('') || '<tr><td colspan="5" style="text-align: center; padding: 20px;">No hay órdenes</td></tr>';

					const { data: allOrders } = await supabase.from('orders').select('total').eq('status', 'completed');
					const revenue = allOrders?.reduce((s, o) => s + o.total, 0) || 0;
					document.getElementById('total-revenue').textContent = `$${revenue.toFixed(2)}`;
				} catch (error) { console.error('Error:', error); }
			}

			loadDashboard();
		</script>
		<script type="module" src="/frontend/js/site.js"></script>
	</body>
</html>
